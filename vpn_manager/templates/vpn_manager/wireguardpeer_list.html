{% extends "./app_base.html" %}
{% load bootstrap_pagination %}
{% load i18n %}

{% block title %}{% trans "All Peers" %}{% endblock %}

{% block breadcrumb_items %}
	<li class="breadcrumb-item active" aria-current="page">{% trans "Peers" %}</li>
{% endblock %}

{% block content %}
	<div class="card">
		<div class="card-header d-flex justify-content-between">
			<h3>{% trans "Connections" %}</h3>
			<a href="{% url 'vpn_manager:add_peer' %}" class="btn btn-primary ml-auto">{% trans "New" %}</a>
		</div>
		<div class="card-body p-0" style="min-height: 200px">
			<div class="table-responsive">

			</div>
			<table class="table table-borderless table-hover">
				{% for peer in peers %}
			    <tr>
			      <td class="lead">{{ peer.name }}</td>
				    <td class="text-monospace"></td>
				    <td style="text-align: right">
					    <div class="dropdown show">
							  <a class="btn btn-primary dropdown-toggle" href="#" role="button" id="peerOptionsLink{{ peer.pk }}" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
							    {% trans "Options" %}
							  </a>
							  <div class="dropdown-menu" aria-labelledby="peerOptionsLink{{ peer.pk }}" id="peerOptionsDropdown{{ peer.pk }}">
								  <a class="dropdown-item" href="{% url 'vpn_manager:show_peer' peer.pk %}">{% trans "Download Configuration" %}</a>
								  <a class="dropdown-item" href="{% url 'vpn_manager:edit_peer' peer.pk %}">{% trans "Edit" %}</a>
								  <a class="dropdown-item text-danger" href="{% url 'vpn_manager:delete_peer' peer.pk %}">{% trans "Delete" %}</a>
							  </div>
							</div>
				    </td>
			    </tr>
				{% empty %}
					<tr>
						<td colspan="3" class="d-flex pt-5">
							<div class="mx-auto lead">{% blocktrans %}No connection. Click on the <span class="text-primary font-weight-bold">New</span> button to start adding connections.{% endblocktrans %}</div>
						</td>
					</tr>
				{% endfor %}
			</table>
		</div>
		<div class="card-footer">
			{% bootstrap_paginate page_obj %}
		</div>
	</div>
{% endblock %}

{% block modals %}
	<div class="modal fade" id="shareLinkModal" tabindex="-1" role="dialog" aria-labelledby="shareLinkModalLabel" aria-hidden="true">
		<div class="modal-dialog modal-dialog-centered" role="document">
			<div class="modal-content">
				<div class="modal-header">
					<h5 class="modal-title lead" id="shareLinkModalLabel">{% trans "Share Configuration Download Link" %}</h5>
					<button type="button" class="close" data-dismiss="modal" aria-label="Close">
						<span aria-hidden="true">&times;</span>
					</button>
				</div>
				<div class="modal-body p-0">
					<div class="card border-0 mb-0">
						<div class="card-body">
							<div class="input-group mb-3">
								<input class="form-control" type="text" id="share-link" readonly />
							  <div class="input-group-append">
							    <button class="btn btn-primary input-group-text copy-to-clipboard" data-target="#share-link">
								    {% trans "Copy" %}
							    </button>
							  </div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
{% endblock %}

{% block extra_js %}
	<script type="text/javascript">
		$('.share-link').on('click', function () {
			const $link = $('#share-link');
			const $modal = $('#shareLinkModal');
			let link = $(this).attr('href');
			$link.val(link);
			$modal.modal('show');
      return false;
		});
	</script>
{% endblock %}
